<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platzbelegungsplaner</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF f√ºr PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const App = () => {
            const APP_VERSION = '1.3.0'; // SemVer: Major.Minor.Patch
            
            const [events, setEvents] = useState([]);
            const [showAddModal, setShowAddModal] = useState(false);
            const [editingEvent, setEditingEvent] = useState(null);
            const [showExportModal, setShowExportModal] = useState(false);
            const [showSeriesModal, setShowSeriesModal] = useState(false);
            const [notifications, setNotifications] = useState([]);
            const [viewMode, setViewMode] = useState('table'); // table, calendar, fields
            const [currentWeek, setCurrentWeek] = useState(0);
            const [hoveredEvent, setHoveredEvent] = useState(null);
            const [hoverPosition, setHoverPosition] = useState({ x: 0, y: 0 });
            // const [conflicts, setConflicts] = useState([]);
            const [isExportingPDF, setIsExportingPDF] = useState(false);
            const [filters, setFilters] = useState({
                field: '',
            
            const fields = [
                { id: 'platz1', name: 'Platz 1', shortName: 'P1', color: 'bg-red-50 border-red-200', headerColor: 'bg-red-500' },
                { id: 'platz2', name: 'Platz 2', shortName: 'P2', color: 'bg-blue-50 border-blue-200', headerColor: 'bg-blue-500' },
                { id: 'platz3', name: 'Platz 3', shortName: 'P3', color: 'bg-green-50 border-green-200', headerColor: 'bg-green-500' },
                { id: 'grundschule', name: 'Grundschule', shortName: 'GS', color: 'bg-yellow-50 border-yellow-200', headerColor: 'bg-yellow-500' },
                { id: 'kunstrasen', name: 'Kunstrasen', shortName: 'KR', color: 'bg-purple-50 border-purple-200', headerColor: 'bg-purple-500' }
            ];

            const timeSlots = ['16:00', '16:30', '17:00', '17:30', '18:00', '18:30', '19:00', '19:30', '20:00', '20:30', '21:00'];
            const weekdays = ['Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag', 'Sonntag'];
            const teams = ['U8', 'U9', 'U10', 'U11', 'U12', 'U13', 'U14', 'U15', 'U16', 'U17', 'U18', 'U19'];
            const cabins = ['Kabine 1', 'Kabine 2', 'Kabine 3', 'Kabine 4', 'Kabine 5'];
            const positions = [
                { value: '', label: 'Keine Angabe', short: '', icon: '' },
                { value: 'li', label: 'Links', short: 'Li', icon: '‚¨ÖÔ∏è' },
                { value: 'mi', label: 'Mitte', short: 'Mi', icon: '‚è∫Ô∏è' },
                { value: 're', label: 'Rechts', short: 'Re', icon: '‚û°Ô∏è' }
            ];

            const eventTypes = {
                training: { label: 'Training', color: 'bg-green-500', icon: 'üèÉ‚Äç‚ôÇÔ∏è' },
                match: { label: 'Pflichtspiel', color: 'bg-blue-500', icon: '‚öΩ' },
                friendly: { label: 'Freundschaftsspiel', color: 'bg-yellow-500', icon: 'ü§ù' },
                cup: { label: 'Pokalspiel', color: 'bg-purple-500', icon: 'üèÜ' },
                makeup: { label: 'Nachholspiel', color: 'bg-red-500', icon: 'üîÑ' },
                blocked: { label: 'Platzsperre', color: 'bg-gray-600', icon: 'üö´' }
            };

            const [newEvent, setNewEvent] = useState({
                field: '', day: '', time: '', duration: 1.5, type: 'training',
                team: '', title: '', cabin: '', trainer: '', position: ''
            });

            const [seriesEvent, setSeriesEvent] = useState({
                field: '', day: '', time: '', duration: 1.5, type: 'training',
                team: '', title: '', cabin: '', trainer: '', position: '', weeks: 10
            });

            // Konflikterkennung
            const detectConflicts = (eventsList) => {
                const conflictsList = [];
                const filteredEvents = eventsList.filter(event => {
                    if (event.weekOffset !== undefined) {
                        return event.weekOffset === currentWeek;
                    }
                    return true;
                });

                for (let i = 0; i < filteredEvents.length; i++) {
                    for (let j = i + 1; j < filteredEvents.length; j++) {
                        const event1 = filteredEvents[i];
                        const event2 = filteredEvents[j];
                        
                        // Nur Events auf demselben Platz und Tag pr√ºfen
                        if (event1.field === event2.field && event1.day === event2.day) {
                            const start1 = parseFloat(event1.time.replace(':', '.').replace('30', '5'));
                            const end1 = start1 + event1.duration;
                            const start2 = parseFloat(event2.time.replace(':', '.').replace('30', '5'));
                            const end2 = start2 + event2.duration;
                            
                            // Zeit√ºberschneidung pr√ºfen
                            if (start1 < end2 && start2 < end1) {
                                conflictsList.push({
                                    id: `${event1.id}-${event2.id}`,
                                    event1: event1,
                                    event2: event2,
                                    field: event1.field,
                                    day: event1.day,
                                    severity: (event1.type === 'blocked' || event2.type === 'blocked') ? 'high' : 'medium'
                                });
                            }
                        }
                        
                        // Kabinenkonflikte pr√ºfen
                        if (event1.cabin && event2.cabin && event1.cabin === event2.cabin && event1.day === event2.day) {
                            const start1 = parseFloat(event1.time.replace(':', '.').replace('30', '5'));
                            const end1 = start1 + event1.duration;
                            const start2 = parseFloat(event2.time.replace(':', '.').replace('30', '5'));
                            const end2 = start2 + event2.duration;
                            
                            if (start1 < end2 && start2 < end1) {
                                conflictsList.push({
                                    id: `cabin-${event1.id}-${event2.id}`,
                                    event1: event1,
                                    event2: event2,
                                    type: 'cabin',
                                    cabin: event1.cabin,
                                    day: event1.day,
                                    severity: 'low'
                                });
                            }
                        }
                    }
                }
                
                return conflictsList;
            };

            // Gefilterte Events
            const getFilteredEvents = () => {
                return events.filter(event => {
                    if (event.weekOffset !== undefined) {
                        if (event.weekOffset !== currentWeek) return false;
                    }
                    
                    if (filters.field && event.field !== filters.field) return false;
                    if (filters.type && event.type !== filters.type) return false;
                    if (filters.team && event.team !== filters.team) return false;
                    return true;
                });
            };

            // Event ist in Konflikt?
            const isEventInConflict = (eventId) => {
                return conflicts.some(conflict => 
                    conflict.event1.id === eventId || conflict.event2.id === eventId
                );
            };

            // Konflikt-Farbe f√ºr Event
            const getConflictColor = (eventId) => {
                const conflict = conflicts.find(conflict => 
                    conflict.event1.id === eventId || conflict.event2.id === eventId
                );
                if (!conflict) return '';
                
                switch (conflict.severity) {
                    case 'high': return 'border-4 border-red-600 bg-red-100';
                    case 'medium': return 'border-2 border-orange-500 bg-orange-50';
                    case 'low': return 'border-2 border-yellow-500 bg-yellow-50';
                    default: return '';
                }
            };

            // PDF Export
            const exportToPDF = async () => {
                if (!window.jsPDF) {
                    addNotification('‚ùå PDF-Export nicht verf√ºgbar', 'warning');
                    return;
                }

                setIsExportingPDF(true);
                try {
                    const { jsPDF } = window.jsPDF;
                    const pdf = new jsPDF('l', 'mm', 'a4'); // Landscape
                    
                    // Header
                    pdf.setFontSize(18);
                    pdf.text('Platzbelegungsplaner', 20, 20);
                    pdf.setFontSize(12);
                    pdf.text(`Woche vom ${formatDate(getWeekStart(currentWeek))}`, 20, 30);
                    
                    // Tabelle erstellen
                    let startY = 45;
                    const cellWidth = 35;
                    const cellHeight = 8;
                    
                    // Header Zeile - Tage
                    pdf.setFillColor(240, 240, 240);
                    pdf.rect(20, startY, 25, cellHeight, 'F');
                    pdf.text('Zeit', 22, startY + 5);
                    
                    const weekDates = getWeekDates(currentWeek);
                    weekDates.forEach((date, index) => {
                        pdf.rect(45 + index * cellWidth, startY, cellWidth, cellHeight, 'F');
                        pdf.text(`${date.day} ${date.date}.${date.month}`, 47 + index * cellWidth, startY + 5);
                    });
                    
                    // Zeiten und Events
                    timeSlots.forEach((time, timeIndex) => {
                        const y = startY + (timeIndex + 1) * cellHeight;
                        
                        // Zeit
                        pdf.rect(20, y, 25, cellHeight);
                        pdf.text(time, 22, y + 5);
                        
                        // Events f√ºr jeden Tag
                        weekdays.forEach((day, dayIndex) => {
                            const x = 45 + dayIndex * cellWidth;
                            pdf.rect(x, y, cellWidth, cellHeight);
                            
                            const dayEvents = getFilteredEvents().filter(e => e.day === day && e.time === time);
                            if (dayEvents.length > 0) {
                                const event = dayEvents[0];
                                const text = `${event.team} - ${fields.find(f => f.id === event.field)?.shortName}`;
                                pdf.setFontSize(8);
                                pdf.text(text, x + 1, y + 4);
                                pdf.setFontSize(12);
                            }
                        });
                    });
                    
                    // Legende
                    let legendY = startY + (timeSlots.length + 2) * cellHeight;
                    pdf.text('Legende:', 20, legendY);
                    legendY += 10;
                    
                    Object.entries(eventTypes).forEach(([key, type], index) => {
                        const x = 20 + (index % 3) * 80;
                        const y = legendY + Math.floor(index / 3) * 8;
                        pdf.text(`${type.icon} ${type.label}`, x, y);
                    });
                    
                    // Konflikte anzeigen
                    if (conflicts.length > 0) {
                        legendY += 30;
                        pdf.setTextColor(255, 0, 0);
                        pdf.text('‚ö†Ô∏è KONFLIKTE ERKANNT:', 20, legendY);
                        pdf.setTextColor(0, 0, 0);
                        
                        conflicts.forEach((conflict, index) => {
                            legendY += 8;
                            const text = conflict.type === 'cabin' 
                                ? `Kabinen-Konflikt: ${conflict.cabin} - ${conflict.day}`
                                : `Platz-Konflikt: ${fields.find(f => f.id === conflict.field)?.name} - ${conflict.day}`;
                            pdf.text(text, 20, legendY);
                        });
                    }
                    
                    pdf.save(`Platzbelegung_${formatDate(getWeekStart(currentWeek)).replace(/\./g, '-')}.pdf`);
                    addNotification('üìÑ PDF erfolgreich erstellt', 'success');
                    
                } catch (error) {
                    console.error('PDF Export Fehler:', error);
                    addNotification('‚ùå Fehler beim PDF-Export', 'warning');
                } finally {
                    setIsExportingPDF(false);
                }
            };

            // Hilfsfunktionen
            const getWeekStart = (weekOffset = 0) => {
                const today = new Date();
                const daysToMonday = today.getDay() === 0 ? 6 : today.getDay() - 1;
                const monday = new Date(today);
                monday.setDate(today.getDate() - daysToMonday + (weekOffset * 7));
                return monday;
            };

            const formatDate = (date) => date.toLocaleDateString('de-DE');

            const getWeekDates = (weekOffset = 0) => {
                const weekStart = getWeekStart(weekOffset);
                return weekdays.map((day, index) => {
                    const date = new Date(weekStart);
                    date.setDate(weekStart.getDate() + index);
                    return { day, date: date.getDate(), month: date.getMonth() + 1 };
                });
            };

            const getEventEndTime = (event) => {
                const startTime = parseFloat(event.time.replace(':', '.').replace('30', '5'));
                const endTime = startTime + event.duration;
                const hours = Math.floor(endTime);
                const minutes = (endTime - hours) * 60;
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
            };

            // Hover-Handler
            const handleEventHover = (event, mouseEvent) => {
                setHoveredEvent(event);
                setHoverPosition({
                    x: mouseEvent.clientX,
                    y: mouseEvent.clientY
                });
            };

            const handleEventLeave = () => {
                setHoveredEvent(null);
            };

            // Hilfsfunktion f√ºr Event-Positionierung
            const getEventPositions = (day) => {
                const filteredEvents = getFilteredEvents();
                const dayEvents = filteredEvents.filter(e => e.day === day);
                const positions = [];
                
                dayEvents.forEach(event => {
                    const startIndex = timeSlots.indexOf(event.time);
                    if (startIndex === -1) return;
                    
                    const endIndex = startIndex + Math.ceil(event.duration * 2); // 30min pro Slot
                    
                    // Finde andere Events zur gleichen Zeit auf dem gleichen Platz
                    const sameTimeFieldEvents = dayEvents.filter(e => 
                        e.time === event.time && 
                        e.field === event.field &&
                        timeSlots.indexOf(e.time) !== -1
                    );
                    
                    // Sortiere Events nach Position (links, mitte, rechts)
                    sameTimeFieldEvents.sort((a, b) => {
                        const positionOrder = { 'li': 0, 'mi': 1, 're': 2, '': 3 };
                        const aOrder = positionOrder[a.position] !== undefined ? positionOrder[a.position] : 3;
                        const bOrder = positionOrder[b.position] !== undefined ? positionOrder[b.position] : 3;
                        return aOrder - bOrder;
                    });
                    
                    // Finde die Position dieses Events in der sortierten Liste
                    const positionInGroup = sameTimeFieldEvents.findIndex(e => e.id === event.id);
                    const groupSize = sameTimeFieldEvents.length;
                    
                    // Berechne Spalte basierend auf Zeit-Konflikten mit anderen Pl√§tzen
                    let column = 0;
                    while (true) {
                        const conflict = positions.find(pos => 
                            pos.column === column &&
                            pos.startIndex < endIndex &&
                            pos.endIndex > startIndex &&
                            pos.field !== event.field // Nur Konflikte mit anderen Pl√§tzen
                        );
                        
                        if (!conflict) break;
                        column++;
                    }
                    
                    positions.push({
                        ...event,
                        column,
                        startIndex,
                        endIndex,
                        positionInGroup,
                        groupSize
                    });
                });
                
                return positions;
            };

            const addNotification = (message, type = 'info') => {
                const notification = { id: Date.now(), message, type };
                setNotifications(prev => [notification, ...prev.slice(0, 2)]);
                setTimeout(() => setNotifications(prev => prev.filter(n => n.id !== notification.id)), 5000);
            };

            const removeNotification = (id) => {
                setNotifications(prev => prev.filter(n => n.id !== id));
            };

            // ESC-Taste Handler
            useEffect(() => {
                const handleEsc = (e) => {
                    if (e.key === 'Escape') {
                        setShowAddModal(false);
                        setShowSeriesModal(false);
                        setShowExportModal(false);
                        setEditingEvent(null);
                    }
                };
                
                window.addEventListener('keydown', handleEsc);
                return () => window.removeEventListener('keydown', handleEsc);
            }, []);

            // Konflikte bei Events-√Ñnderung neu berechnen
            useEffect(() => {
                const newConflicts = detectConflicts(events);
                setConflicts(newConflicts);
                
                // Benachrichtigung bei neuen Konflikten
                if (newConflicts.length > conflicts.length) {
                    const newConflictCount = newConflicts.length - conflicts.length;
                    addNotification(`‚ö†Ô∏è ${newConflictCount} neue Konflikt(e) erkannt!`, 'warning');
                }
            }, [events, currentWeek]);

            useEffect(() => {
                try {
                    const saved = window.localStorage.getItem('football-events');
                    if (saved) {
                        setEvents(JSON.parse(saved));
                    } else {
                        const examples = [
                            { id: 1, field: 'platz2', day: 'Montag', time: '17:00', duration: 1.5, type: 'training', team: 'U15', title: 'U15 Training', cabin: 'Kabine 1', trainer: 'Max Mustermann', position: 'mi' },
                            { id: 2, field: 'platz1', day: 'Dienstag', time: '18:00', duration: 2, type: 'match', team: 'U16', title: 'U16 vs FC Hamburg', cabin: 'Kabine 2', trainer: 'Anna Schmidt', position: 'li' }
                        ];
                        setEvents(examples);
                        window.localStorage.setItem('football-events', JSON.stringify(examples));
                    }
                } catch (e) {
                    console.error('Fehler beim Laden der Daten:', e);
                    const examples = [
                        { id: 1, field: 'platz2', day: 'Montag', time: '17:00', duration: 1.5, type: 'training', team: 'U15', title: 'U15 Training', cabin: 'Kabine 1', trainer: 'Max Mustermann', position: 'mi' }
                    ];
                    setEvents(examples);
                }
            }, []);

            useEffect(() => {
                if (events.length > 0) {
                    try {
                        window.localStorage.setItem('football-events', JSON.stringify(events));
                    } catch (e) {
                        console.error('Fehler beim Speichern der Daten:', e);
                        addNotification('‚ö†Ô∏è Daten konnten nicht gespeichert werden', 'warning');
                    }
                }
            }, [events]);

            const validateEvent = (event) => {
                if (event.type === 'blocked') {
                    // F√ºr Platzsperren nur Platz, Tag und Zeit erforderlich
                    if (!event.field || !event.day || !event.time) {
                        return 'Bitte Platz, Tag und Zeit ausw√§hlen!';
                    }
                } else {
                    // F√ºr andere Events alle Felder erforderlich
                    if (!event.field || !event.day || !event.time || !event.team || !event.title) {
                        return 'Bitte alle Pflichtfelder ausf√ºllen!';
                    }
                }
                return null;
            };

            const addEvent = () => {
                const error = validateEvent(newEvent);
                if (error) {
                    addNotification(error, 'warning');
                    return;
                }
                
                // Bei Platzsperre automatisch Team und Titel setzen
                const eventToAdd = {...newEvent};
                if (eventToAdd.type === 'blocked') {
                    eventToAdd.team = 'SPERRE';
                    if (!eventToAdd.title) {
                        eventToAdd.title = 'Platzsperre';
                    }
                }
                
                setEvents(prev => [...prev, { ...eventToAdd, id: Date.now() }]);
                setNewEvent({ field: '', day: '', time: '', duration: 1.5, type: 'training', team: '', title: '', cabin: '', trainer: '', position: '' });
                setShowAddModal(false);
                addNotification('‚úÖ Termin hinzugef√ºgt', 'success');
            };

            const updateEvent = () => {
                const error = validateEvent(editingEvent);
                if (error) {
                    addNotification(error, 'warning');
                    return;
                }
                
                const oldEvent = events.find(e => e.id === editingEvent.id);
                const hasChanges = JSON.stringify(oldEvent) !== JSON.stringify(editingEvent);
                
                setEvents(prev => prev.map(e => e.id === editingEvent.id ? editingEvent : e));
                setEditingEvent(null);
                
                if (hasChanges) {
                    addNotification('‚úèÔ∏è Termin aktualisiert - √Ñnderungen gespeichert', 'success');
                } else {
                    addNotification('‚ÑπÔ∏è Keine √Ñnderungen vorgenommen', 'info');
                }
            };

            const deleteEvent = (id) => {
                if (confirm('Termin l√∂schen?')) {
                    const deletedEvent = events.find(e => e.id === id);
                    setEvents(prev => prev.filter(e => e.id !== id));
                    setEditingEvent(null); // Modal schlie√üen
                    addNotification(`üóëÔ∏è Termin "${deletedEvent?.title}" gel√∂scht`, 'info');
                }
            };

            const createSeriesEvents = () => {
                const error = validateEvent(seriesEvent);
                if (error) {
                    addNotification(error, 'warning');
                    return;
                }
                const newEvents = [];
                const baseDate = getWeekStart(currentWeek);
                const dayIndex = weekdays.indexOf(seriesEvent.day);
                
                for (let week = 0; week < seriesEvent.weeks; week++) {
                    const eventDate = new Date(baseDate);
                    eventDate.setDate(baseDate.getDate() + dayIndex + (week * 7));
                    
                    newEvents.push({ 
                        ...seriesEvent, 
                        id: Date.now() + week, 
                        isSeriesEvent: true,
                        weekOffset: week,
                        eventDate: eventDate.toISOString()
                    });
                }
                setEvents(prev => [...prev, ...newEvents]);
                setSeriesEvent({ field: '', day: '', time: '', duration: 1.5, type: 'training', team: '', title: '', cabin: '', trainer: '', position: '', weeks: 10 });
                setShowSeriesModal(false);
                addNotification(`üìÖ ${newEvents.length} Serientermine erstellt`, 'success');
            };

            const exportToCSV = () => {
                const headers = ['Platz', 'Tag', 'Zeit', 'Dauer', 'Typ', 'Team', 'Titel', 'Trainer', 'Kabine', 'Position'];
                const csv = [
                    headers.join(','),
                    ...events.map(e => [
                        fields.find(f => f.id === e.field)?.name || '',
                        e.day, e.time, e.duration, eventTypes[e.type].label,
                        e.team, e.title, e.trainer || '', e.cabin || '', 
                        positions.find(p => p.value === e.position)?.label || ''
                    ].map(field => `"${field}"`).join(','))
                ].join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'termine.csv';
                a.click();
                URL.revokeObjectURL(url);
                addNotification('üì• CSV exportiert', 'success');
            };

            const exportToJSON = () => {
                const dataStr = JSON.stringify(events, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `termine_backup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                addNotification('üíæ Backup erstellt', 'success');
            };

            const importFromJSON = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedEvents = JSON.parse(e.target.result);
                        if (Array.isArray(importedEvents)) {
                            setEvents(importedEvents);
                            addNotification('üìÇ Daten importiert', 'success');
                        } else {
                            addNotification('‚ùå Ung√ºltiges Dateiformat', 'warning');
                        }
                    } catch (error) {
                        addNotification('‚ùå Fehler beim Importieren', 'warning');
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            };

            const clearFilters = () => {
                setFilters({ field: '', type: '', team: '' });
            };

            const hasActiveFilters = () => {
                return filters.field || filters.type || filters.team;
            };

            return (
                <div className="max-w-7xl mx-auto p-4">
                    {/* Header */}
                    <div className="flex items-center justify-between mb-6 flex-wrap gap-4">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold">FC</div>
                            <div>
                                <h1 className="text-2xl font-bold">Platzbelegungsplaner</h1>
                                <p className="text-gray-600 text-sm">Fu√üballverein Jugendabteilung ‚Ä¢ v{APP_VERSION}</p>
                            </div>
                        </div>
                        <div className="flex gap-2 flex-wrap">
                            <div className="flex bg-gray-100 rounded p-1">
                                <button onClick={() => setViewMode('table')} className={`px-2 py-1 rounded text-sm transition-colors ${viewMode === 'table' ? 'bg-white shadow' : 'hover:bg-gray-200'}`}>üìä</button>
                                <button onClick={() => setViewMode('calendar')} className={`px-2 py-1 rounded text-sm transition-colors ${viewMode === 'calendar' ? 'bg-white shadow' : 'hover:bg-gray-200'}`}>üìÖ</button>
                                <button onClick={() => setViewMode('fields')} className={`px-2 py-1 rounded text-sm transition-colors ${viewMode === 'fields' ? 'bg-white shadow' : 'hover:bg-gray-200'}`}>üèüÔ∏è</button>
                            </div>
                            <button onClick={() => setShowSeriesModal(true)} className="bg-purple-600 text-white px-3 py-1 rounded text-sm hover:bg-purple-700 transition-colors">Serie</button>
                            <button onClick={() => setShowExportModal(true)} className="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">Export</button>
                            <button onClick={() => setShowAddModal(true)} className="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition-colors">+ Hinzuf√ºgen</button>
                        </div>
                    </div>

                    {/* Konflikte Warnung */}
                    {conflicts.length > 0 && (
                        <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                            <div className="flex items-center gap-2 mb-2">
                                <span className="text-red-600 text-lg">‚ö†Ô∏è</span>
                                <h3 className="font-medium text-red-800">
                                    {conflicts.length} Konflikt{conflicts.length > 1 ? 'e' : ''} erkannt
                                </h3>
                            </div>
                            <div className="space-y-1 text-sm text-red-700">
                                {conflicts.map(conflict => (
                                    <div key={conflict.id} className="flex items-center gap-2">
                                        <span className={`w-2 h-2 rounded-full ${
                                            conflict.severity === 'high' ? 'bg-red-600' : 
                                            conflict.severity === 'medium' ? 'bg-orange-500' : 'bg-yellow-500'
                                        }`}></span>
                                        <span>
                                            {conflict.type === 'cabin' 
                                                ? `Kabinen-Konflikt: ${conflict.cabin} am ${conflict.day}`
                                                : `Platz-Konflikt: ${fields.find(f => f.id === conflict.field)?.name} am ${conflict.day}`
                                            }
                                        </span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Filter Panel - IMMER SICHTBAR */}
                    <div className="bg-white rounded-lg shadow p-4 mb-4">
                        <div className="flex items-center justify-between mb-3">
                            <h3 className="font-medium text-sm flex items-center gap-2">
                                üîç Filter
                                {hasActiveFilters() && (
                                    <span className="bg-orange-100 text-orange-800 px-2 py-0.5 rounded-full text-xs">
                                        Aktiv
                                    </span>
                                )}
                            </h3>
                            {hasActiveFilters() && (
                                <button 
                                    onClick={clearFilters}
                                    className="bg-gray-500 text-white px-2 py-1 rounded text-xs hover:bg-gray-600 transition-colors"
                                >
                                    Zur√ºcksetzen
                                </button>
                            )}
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <div>
                                <label className="block text-xs font-medium mb-1">Platz</label>
                                <select 
                                    value={filters.field} 
                                    onChange={(e) => setFilters({...filters, field: e.target.value})}
                                    className="w-full border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                >
                                    <option value="">Alle Pl√§tze</option>
                                    {fields.map(f => <option key={f.id} value={f.id}>{f.name}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="block text-xs font-medium mb-1">Typ</label>
                                <select 
                                    value={filters.type} 
                                    onChange={(e) => setFilters({...filters, type: e.target.value})}
                                    className="w-full border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                >
                                    <option value="">Alle Typen</option>
                                    {Object.entries(eventTypes).map(([k, t]) => <option key={k} value={k}>{t.icon} {t.label}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="block text-xs font-medium mb-1">Team</label>
                                <select 
                                    value={filters.team} 
                                    onChange={(e) => setFilters({...filters, team: e.target.value})}
                                    className="w-full border rounded p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                >
                                    <option value="">Alle Teams</option>
                                    {teams.map(t => <option key={t} value={t}>{t}</option>)}
                                </select>
                            </div>
                        </div>
                        {hasActiveFilters() && (
                            <div className="mt-3 text-sm text-gray-600">
                                Zeige {getFilteredEvents().length} von {events.length} Terminen
                            </div>
                        )}
                    </div>

                    {/* Wochennavigation */}
                    <div className="mb-4 flex items-center justify-between bg-white rounded-lg shadow p-3">
                        <div className="flex items-center gap-3">
                            <button onClick={() => setCurrentWeek(p => p - 1)} className="bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded text-sm transition-colors">‚Üê</button>
                            <span className="font-medium text-sm">Woche vom {formatDate(getWeekStart(currentWeek))}</span>
                            <button onClick={() => setCurrentWeek(p => p + 1)} className="bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded text-sm transition-colors">‚Üí</button>
                        </div>
                        <button onClick={() => setCurrentWeek(0)} className="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition-colors">Aktuelle Woche</button>
                    </div>

                    {/* Tabellenansicht */}
                    {viewMode === 'table' && (
                        <div className="bg-white rounded-lg shadow overflow-x-auto">
                            <div className="flex border-b min-w-[1200px]">
                                <div className="w-20 p-3 bg-gray-100 font-medium text-sm border-r">Zeit</div>
                                {getWeekDates(currentWeek).map(({ day, date, month }) => (
                                    <div key={day} className="w-40 p-3 bg-gray-100 font-medium text-center text-sm border-r">
                                        <div>{day}</div>
                                        <div className="text-xs text-gray-600">{date}.{month}</div>
                                    </div>
                                ))}
                            </div>

                            <div className="relative">
                                {timeSlots.map(time => (
                                    <div key={time} className="flex border-b min-h-[60px] min-w-[1200px]">
                                        <div className="w-20 p-3 bg-gray-50 border-r flex items-center text-sm font-medium">{time}</div>
                                        {weekdays.map(day => (
                                            <div key={day} className="w-40 border-r p-2 relative">
                                                {!getFilteredEvents().some(e => e.day === day && e.time === time) && (
                                                    <div
                                                        className="absolute inset-0 hover:bg-gray-50 cursor-pointer opacity-0 hover:opacity-100 flex items-center justify-center transition-opacity"
                                                        onClick={() => { setNewEvent({...newEvent, day, time}); setShowAddModal(true); }}
                                                    >
                                                        <span className="text-gray-400 text-lg">+</span>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                ))}
                                
                                {/* Event Bl√∂cke */}
                                {weekdays.map((day, dayIndex) => {
                                    const eventPositions = getEventPositions(day);
                                    const maxColumns = Math.max(1, ...eventPositions.map(pos => pos.column + 1));
                                    
                                    return eventPositions.map(eventPos => {
                                        const eventType = eventTypes[eventPos.type];
                                        const field = fields.find(f => f.id === eventPos.field);
                                        const isInConflict = isEventInConflict(eventPos.id);
                                        const conflictColor = getConflictColor(eventPos.id);
                                        
                                        const topPos = eventPos.startIndex * 60 + 4;
                                        const eventSlots = Math.ceil(eventPos.duration * 2); // Anzahl der 30-Minuten-Slots
                                        const height = eventSlots * 60 - 8; // 60px pro Slot, minus padding
                                        
                                        // Einfache und klare Positionierung
                                        const timeColumnWidth = 80; // w-20 = 80px
                                        const dayColumnWidth = 160; // w-40 = 160px  
                                        const dayStartX = timeColumnWidth + (dayIndex * dayColumnWidth);
                                        const availableWidth = dayColumnWidth - 8; // 8px padding (4px links + 4px rechts)
                                        
                                        let eventLeft = dayStartX + 4; // 4px padding von links
                                        let eventWidth = availableWidth;
                                        
                                        // Bei mehreren Spalten (verschiedene Pl√§tze) verteilen
                                        if (maxColumns > 1) {
                                            const columnWidth = availableWidth / maxColumns;
                                            eventLeft = dayStartX + 4 + (eventPos.column * columnWidth);
                                            eventWidth = columnWidth - 4;
                                            
                                            // Sub-Position f√ºr gleichen Platz zur gleichen Zeit
                                            if (eventPos.groupSize > 1) {
                                                const subWidth = columnWidth / eventPos.groupSize;
                                                eventLeft += eventPos.positionInGroup * subWidth;
                                                eventWidth = subWidth - 2;
                                            }
                                        } else {
                                            // Nur eine Spalte - Events auf gleichem Platz teilen sich die volle Breite
                                            if (eventPos.groupSize > 1) {
                                                const subWidth = availableWidth / eventPos.groupSize;
                                                eventLeft += eventPos.positionInGroup * subWidth;
                                                eventWidth = subWidth - 2;
                                            }
                                        }
                                        
                                        // Position-Indikator f√ºr kleine Bl√∂cke
                                        const positionObj = positions.find(p => p.value === eventPos.position);
                                        const positionIndicator = positionObj?.icon || '';
                                        
                                        // Entscheidung f√ºr kompakte Darstellung basierend auf verf√ºgbarer Breite
                                        const isCompact = eventWidth < 120;
                                        
                                        return (
                                            <div
                                                key={eventPos.id}
                                                className={`${field?.color} ${conflictColor} border rounded shadow-sm cursor-pointer hover:shadow-md transition-shadow absolute z-10 text-xs overflow-hidden ${isInConflict ? 'animate-pulse' : ''}`}
                                                style={{ 
                                                    top: `${topPos}px`,
                                                    left: `${eventLeft}px`,
                                                    width: `${eventWidth}px`,
                                                    height: `${height}px`
                                                }}
                                                onClick={() => setEditingEvent({...eventPos})}
                                                onMouseEnter={(e) => handleEventHover(eventPos, e)}
                                                onMouseLeave={handleEventLeave}
                                                onMouseMove={(e) => {
                                                    if (hoveredEvent?.id === eventPos.id) {
                                                        setHoverPosition({ x: e.clientX, y: e.clientY });
                                                    }
                                                }}
                                            >
                                                {/* Typ-Header */}
                                                <div className={`${eventType.color} text-white text-xs px-1 py-1 rounded-t font-medium flex items-center justify-between`}>
                                                    <div className="flex items-center gap-1 truncate">
                                                        <span>{eventType.icon}</span>
                                                        {!isCompact && <span className="truncate">{eventType.label}</span>}
                                                    </div>
                                                    <div className="flex items-center gap-1">
                                                        {positionIndicator && <span className="text-white font-bold">{positionIndicator}</span>}
                                                        {isInConflict && <span className="text-red-200">‚ö†Ô∏è</span>}
                                                    </div>
                                                </div>
                                                
                                                {/* Event Content */}
                                                <div className="p-1 space-y-0.5">
                                                    {/* Jugend und Titel */}
                                                    <div className="font-bold text-gray-800 text-xs truncate">{eventPos.team}</div>
                                                    {!isCompact && <div className="font-medium text-gray-700 text-xs truncate">{eventPos.title}</div>}
                                                    
                                                    {/* Platz und Position - kompakt */}
                                                    <div className="text-gray-600 text-xs truncate">
                                                        üìç {isCompact ? field?.shortName : field?.name}
                                                        {eventPos.position && isCompact && ` (${positions.find(p => p.value === eventPos.position)?.short})`}
                                                        {eventPos.position && !isCompact && ` (${positions.find(p => p.value === eventPos.position)?.label})`}
                                                    </div>
                                                    
                                                    {/* Kabine - nur wenn nicht kompakt */}
                                                    {eventPos.cabin && !isCompact && (
                                                        <div className="text-gray-600 text-xs truncate">üö™ {eventPos.cabin}</div>
                                                    )}
                                                    
                                                    {/* Start- und Endzeit */}
                                                    <div className="text-gray-600 text-xs font-medium">
                                                        üïê {eventPos.time} - {getEventEndTime(eventPos)}
                                                    </div>
                                                    
                                                    {/* Trainer - nur wenn nicht kompakt */}
                                                    {eventPos.trainer && !isCompact && (
                                                        <div className="text-gray-600 text-xs truncate">üë®‚Äçüè´ {eventPos.trainer}</div>
                                                    )}
                                                    
                                                    {/* Serie-Indikator - nur wenn nicht kompakt */}
                                                    {eventPos.isSeriesEvent && !isCompact && (
                                                        <div className="text-gray-500 text-xs">üîÑ Serie</div>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    });
                                })}
                            </div>
                        </div>
                    )}

                    {/* Kalenderansicht */}
                    {viewMode === 'calendar' && (
                        <div className="bg-white rounded-lg shadow">
                            <div className="grid grid-cols-7 border-b">
                                {getWeekDates(currentWeek).map(({ day, date, month }) => (
                                    <div key={day} className="p-3 bg-gray-100 text-center border-r text-sm">
                                        <div className="font-medium">{day}</div>
                                        <div className="text-xs text-gray-600">{date}.{month}</div>
                                    </div>
                                ))}
                            </div>
                            <div className="grid grid-cols-7 min-h-[400px]">
                                {weekdays.map(day => (
                                    <div key={day} className="border-r p-2 space-y-1">
                                        {getFilteredEvents()
                                            .filter(e => e.day === day)
                                            .sort((a, b) => a.time.localeCompare(b.time))
                                            .map(event => {
                                                const eventType = eventTypes[event.type];
                                                const field = fields.find(f => f.id === event.field);
                                                const isInConflict = isEventInConflict(event.id);
                                                const conflictColor = getConflictColor(event.id);
                                                return (
                                                    <div 
                                                        key={event.id} 
                                                        className={`${field?.color} ${conflictColor} border rounded-lg shadow-sm text-xs cursor-pointer hover:shadow transition-shadow ${isInConflict ? 'animate-pulse' : ''}`} 
                                                        onClick={() => setEditingEvent({...event})}
                                                        onMouseEnter={(e) => handleEventHover(event, e)}
                                                        onMouseLeave={handleEventLeave}
                                                        onMouseMove={(e) => {
                                                            if (hoveredEvent?.id === event.id) {
                                                                setHoverPosition({ x: e.clientX, y: e.clientY });
                                                            }
                                                        }}
                                                    >
                                                        {/* Typ-Header */}
                                                        <div className={`${eventType.color} text-white text-xs px-2 py-1 rounded-t-lg font-medium flex items-center justify-between`}>
                                                            <div className="flex items-center gap-1">
                                                                <span>{eventType.icon}</span>
                                                                <span className="truncate">{eventType.label}</span>
                                                            </div>
                                                            {isInConflict && <span className="text-red-200">‚ö†Ô∏è</span>}
                                                        </div>
                                                        
                                                        {/* Event Content */}
                                                        <div className="p-2">
                                                            <div className="font-semibold text-gray-800">{event.time} - {getEventEndTime(event)}</div>
                                                            <div className="font-semibold text-gray-800">{event.team}</div>
                                                            <div className="text-gray-600">{field?.name}</div>
                                                            {event.trainer && <div className="text-gray-600">üë®‚Äçüè´ {event.trainer}</div>}
                                                            {event.cabin && <div className="text-gray-600">üö™ {event.cabin}</div>}
                                                            {event.position && <div className="text-gray-600">{positions.find(p => p.value === event.position)?.icon} {positions.find(p => p.value === event.position)?.label}</div>}
                                                            {event.isSeriesEvent && <div className="text-gray-600">üîÑ Serie</div>}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        <div className="border-2 border-dashed border-gray-300 rounded p-2 text-center cursor-pointer hover:border-green-400 text-xs transition-colors" onClick={() => { setNewEvent({...newEvent, day}); setShowAddModal(true); }}>
                                            + Hinzuf√ºgen
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Platz√ºbersicht - wie Excel */}
                    {viewMode === 'fields' && (
                        <div className="bg-white rounded-lg shadow overflow-auto" id="fields-view">
                            <table className="min-w-full" style={{ minWidth: '1200px' }}>
                                {/* Header */}
                                <thead className="sticky top-0 z-20 bg-white">
                                    {/* Erste Zeile: Wochentage */}
                                    <tr>
                                        <th className="w-20 bg-gray-100 border-r-2 border-b border-gray-400"></th>
                                        {getWeekDates(currentWeek).map(({ day, date, month }, dayIndex) => (
                                            <th 
                                                key={day} 
                                                colSpan={fields.length}
                                                className={`bg-gray-200 text-center font-medium text-sm border-b border-gray-300 p-2 ${dayIndex < weekdays.length - 1 ? 'border-r-2 border-gray-600' : ''}`}
                                            >
                                                <div>{day}</div>
                                                <div className="text-xs text-gray-600">{date}.{month}</div>
                                            </th>
                                        ))}
                                    </tr>
                                    
                                    {/* Zweite Zeile: Pl√§tze */}
                                    <tr>
                                        <th className="w-20 bg-gray-100 border-r-2 border-b-2 border-gray-400"></th>
                                        {weekdays.map((day, dayIndex) => (
                                            <React.Fragment key={day}>
                                                {fields.map((field, fieldIndex) => (
                                                    <th 
                                                        key={`${day}-${field.id}`} 
                                                        className={`w-24 ${field.headerColor} text-white text-center py-1 text-xs font-medium border-b-2 border-gray-400 ${
                                                            fieldIndex < fields.length - 1 ? 'border-r border-gray-300' : ''
                                                        } ${
                                                            fieldIndex === fields.length - 1 && dayIndex < weekdays.length - 1 ? 'border-r-2 border-gray-600' : ''
                                                        }`}
                                                    >
                                                        {field.shortName}
                                                    </th>
                                                ))}
                                            </React.Fragment>
                                        ))}
                                    </tr>
                                </thead>
                                
                                {/* Body: Zeitslots */}
                                <tbody>
                                    {timeSlots.map((time, timeIndex) => (
                                        <tr key={time}>
                                            {/* Zeit */}
                                            <td className={`w-20 bg-gray-50 border-r-2 border-gray-400 p-2 text-xs font-medium text-gray-600 text-center sticky left-0 z-10 ${timeIndex < timeSlots.length - 1 ? 'border-b' : ''} border-gray-300`}>
                                                {time}
                                            </td>
                                            
                                            {/* Events pro Tag und Platz */}
                                            {weekdays.map((day, dayIndex) => (
                                                <React.Fragment key={day}>
                                                    {fields.map((field, fieldIdx) => {
                                                        const slotEvents = getFilteredEvents().filter(e => 
                                                            e.day === day && 
                                                            e.field === field.id && 
                                                            e.time === time
                                                        );
                                                        
                                                        // Pr√ºfe ob dieser Slot von einem l√§ngeren Event belegt ist
                                                        const occupyingEvent = getFilteredEvents().find(e => {
                                                            if (e.day !== day || e.field !== field.id) return false;
                                                            const eventStartIdx = timeSlots.indexOf(e.time);
                                                            const eventEndIdx = eventStartIdx + Math.ceil(e.duration * 2);
                                                            return eventStartIdx <= timeIndex && timeIndex < eventEndIdx;
                                                        });
                                                        
                                                        // Ist dies der Start eines Events?
                                                        const isEventStart = slotEvents.length > 0;
                                                        const isOccupied = occupyingEvent && !isEventStart;
                                                        
                                                        return (
                                                            <td 
                                                                key={`${day}-${field.id}`} 
                                                                className={`w-24 h-10 ${timeIndex < timeSlots.length - 1 ? 'border-b' : ''} border-gray-300 ${
                                                                    fieldIdx < fields.length - 1 ? 'border-r border-gray-300' : ''
                                                                } ${
                                                                    fieldIdx === fields.length - 1 && dayIndex < weekdays.length - 1 ? 'border-r-2 border-gray-600' : ''
                                                                } p-0.5 relative ${
                                                                    !occupyingEvent ? 'hover:bg-gray-50' : ''
                                                                }`}
                                                            >
                                                                {isEventStart && slotEvents.map(event => {
                                                                    const eventType = eventTypes[event.type];
                                                                    const eventSlots = Math.ceil(event.duration * 2);
                                                                    const isBlocker = event.type === 'blocked';
                                                                    const isInConflict = isEventInConflict(event.id);
                                                                    const conflictColor = getConflictColor(event.id);
                                                                    
                                                                    return (
                                                                        <div
                                                                            key={event.id}
                                                                            className={`absolute ${isBlocker ? 'bg-gray-600' : eventType.color} ${conflictColor} text-white rounded shadow-sm cursor-pointer hover:shadow-md transition-shadow z-20 overflow-hidden ${isInConflict ? 'animate-pulse' : ''}`}
                                                                            style={{
                                                                                top: '2px',
                                                                                left: '2px',
                                                                                right: '2px',
                                                                                height: `calc(${eventSlots * 40}px - 4px)`
                                                                            }}
                                                                            onClick={() => setEditingEvent({...event})}
                                                                            onMouseEnter={(e) => handleEventHover(event, e)}
                                                                            onMouseLeave={handleEventLeave}
                                                                        >
                                                                            <div className="p-1 text-xs h-full flex flex-col">
                                                                                <div className="flex items-center justify-between">
                                                                                    <div className="flex items-center gap-1">
                                                                                        <span>{eventType.icon}</span>
                                                                                        {!isBlocker && <span className="font-bold truncate">{event.team}</span>}
                                                                                        {isBlocker && <span className="font-bold truncate text-xs">{eventType.label}</span>}
                                                                                    </div>
                                                                                    {isInConflict && <span className="text-red-200">‚ö†Ô∏è</span>}
                                                                                </div>
                                                                                {event.duration > 0.5 && !isBlocker && event.trainer && (
                                                                                    <div className="truncate text-xs opacity-90">
                                                                                        {event.trainer}
                                                                                    </div>
                                                                                )}
                                                                                {event.position && positions.find(p => p.value === event.position)?.icon && (
                                                                                    <div className="text-xs">
                                                                                        {positions.find(p => p.value === event.position)?.icon}
                                                                                    </div>
                                                                                )}
                                                                            </div>
                                                                        </div>
                                                                    );
                                                                })}
                                                                
                                                                {/* Hinzuf√ºgen Button wenn leer und nicht belegt */}
                                                                {!occupyingEvent && !isOccupied && (
                                                                    <div 
                                                                        className="absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer"
                                                                        onClick={() => {
                                                                            setNewEvent({...newEvent, day, time, field: field.id});
                                                                            setShowAddModal(true);
                                                                        }}
                                                                    >
                                                                        <div className="w-6 h-6 bg-gray-300 rounded-full flex items-center justify-center text-gray-600 text-sm">
                                                                            +
                                                                        </div>
                                                                    </div>
                                                                )}
                                                            </td>
                                                        );
                                                    })}
                                                </React.Fragment>
                                            ))}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}

                    {/* Hover Tooltip */}
                    {hoveredEvent && (
                        <div 
                            className="fixed z-50 bg-white border shadow-lg rounded-lg p-3 pointer-events-none max-w-xs"
                            style={{
                                left: `${hoverPosition.x + 10}px`,
                                top: `${hoverPosition.y - 10}px`,
                                transform: hoverPosition.x > window.innerWidth - 300 ? 'translateX(-100%)' : 'none'
                            }}
                        >
                            <div className="space-y-2">
                                {/* Header */}
                                <div className={`${eventTypes[hoveredEvent.type].color} text-white px-2 py-1 rounded font-medium text-sm flex items-center gap-2`}>
                                    <span>{eventTypes[hoveredEvent.type].icon}</span>
                                    <span>{eventTypes[hoveredEvent.type].label}</span>
                                    {isEventInConflict(hoveredEvent.id) && <span className="text-red-200">‚ö†Ô∏è</span>}
                                </div>
                                
                                {/* Hauptinformationen */}
                                <div className="space-y-1 text-sm">
                                    <div className="font-bold text-gray-800">{hoveredEvent.team}</div>
                                    <div className="font-medium text-gray-700">{hoveredEvent.title}</div>
                                    
                                    {/* Zeit */}
                                    <div className="flex items-center gap-1 text-gray-600">
                                        <span>üïê</span>
                                        <span>{hoveredEvent.day}, {hoveredEvent.time} - {getEventEndTime(hoveredEvent)}</span>
                                    </div>
                                    
                                    {/* Platz */}
                                    <div className="flex items-center gap-1 text-gray-600">
                                        <span>üìç</span>
                                        <span>{fields.find(f => f.id === hoveredEvent.field)?.name}</span>
                                        {hoveredEvent.position && (
                                            <span className="ml-1">
                                                ({positions.find(p => p.value === hoveredEvent.position)?.icon} {positions.find(p => p.value === hoveredEvent.position)?.label})
                                            </span>
                                        )}
                                    </div>
                                    
                                    {/* Trainer */}
                                    {hoveredEvent.trainer && (
                                        <div className="flex items-center gap-1 text-gray-600">
                                            <span>üë®‚Äçüè´</span>
                                            <span>{hoveredEvent.trainer}</span>
                                        </div>
                                    )}
                                    
                                    {/* Kabine */}
                                    {hoveredEvent.cabin && (
                                        <div className="flex items-center gap-1 text-gray-600">
                                            <span>üö™</span>
                                            <span>{hoveredEvent.cabin}</span>
                                        </div>
                                    )}
                                    
                                    {/* Dauer */}
                                    <div className="flex items-center gap-1 text-gray-600">
                                        <span>‚è±Ô∏è</span>
                                        <span>{hoveredEvent.duration}h</span>
                                    </div>
                                    
                                    {/* Serie-Indikator */}
                                    {hoveredEvent.isSeriesEvent && (
                                        <div className="flex items-center gap-1 text-gray-600">
                                            <span>üîÑ</span>
                                            <span>Serientermin</span>
                                        </div>
                                    )}

                                    {/* Konflikt-Warnung */}
                                    {isEventInConflict(hoveredEvent.id) && (
                                        <div className="border-t pt-2 mt-2">
                                            <div className="text-red-600 text-xs font-medium">‚ö†Ô∏è Konflikt erkannt!</div>
                                            {conflicts.filter(c => c.event1.id === hoveredEvent.id || c.event2.id === hoveredEvent.id).map(conflict => (
                                                <div key={conflict.id} className="text-red-600 text-xs">
                                                    {conflict.type === 'cabin' ? `Kabinen-Konflikt: ${conflict.cabin}` : 'Platz-Konflikt'}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                
                                <div className="text-xs text-gray-500 border-t pt-2">
                                    Klicken zum Bearbeiten
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Legende */}
                    <div className="mt-4 bg-white rounded-lg shadow p-4">
                        <h3 className="font-medium mb-2 text-sm">Legende</h3>
                        <div className="grid grid-cols-2 md:grid-cols-5 gap-2">
                            {Object.entries(eventTypes).map(([key, type]) => (
                                <div key={key} className={`${type.color} text-white border rounded p-2 text-center text-xs font-medium`}>
                                    {type.icon} {type.label}
                                </div>
                            ))}
                        </div>
                        <div className="mt-3">
                            <h4 className="font-medium mb-2 text-sm">Pl√§tze</h4>
                            <div className="grid grid-cols-2 md:grid-cols-5 gap-2">
                                {fields.map(field => (
                                    <div key={field.id} className={`${field.color} border rounded p-2 text-center text-xs font-medium text-gray-700`}>
                                        {field.name} ({field.shortName})
                                    </div>
                                ))}
                            </div>
                        </div>
                        <div className="mt-3">
                            <h4 className="font-medium mb-2 text-sm">Positionen</h4>
                            <div className="grid grid-cols-3 gap-2">
                                {positions.filter(p => p.value).map(position => (
                                    <div key={position.value} className="bg-gray-100 border rounded p-2 text-center text-xs font-medium text-gray-700">
                                        {position.icon} {position.label} ({position.short})
                                    </div>
                                ))}
                            </div>
                        </div>
                        {conflicts.length > 0 && (
                            <div className="mt-3">
                                <h4 className="font-medium mb-2 text-sm">Konflikt-Indikatoren</h4>
                                <div className="grid grid-cols-3 gap-2">
                                    <div className="bg-red-100 border-2 border-red-600 rounded p-2 text-center text-xs font-medium text-red-700">
                                        Schwerwiegend (Platzsperre)
                                    </div>
                                    <div className="bg-orange-50 border-2 border-orange-500 rounded p-2 text-center text-xs font-medium text-orange-700">
                                        Mittel (Platz-Konflikt)
                                    </div>
                                    <div className="bg-yellow-50 border-2 border-yellow-500 rounded p-2 text-center text-xs font-medium text-yellow-700">
                                        Niedrig (Kabinen-Konflikt)
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Modal: Neuer Termin */}
                    {showAddModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={(e) => { if (e.target === e.currentTarget) setShowAddModal(false); }}>
                            <div className="bg-white rounded-lg w-full max-w-md max-h-[90vh] flex flex-col" onClick={(e) => e.stopPropagation()}>
                                <div className="flex justify-between items-center p-6 border-b">
                                    <h2 className="text-lg font-bold">Neuer Termin</h2>
                                    <button onClick={() => setShowAddModal(false)} className="text-gray-500 hover:text-gray-700 text-xl">√ó</button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-6">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Platz *</label>
                                            <select value={newEvent.field} onChange={(e) => setNewEvent({...newEvent, field: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                                <option value="">W√§hlen</option>
                                                {fields.map(f => <option key={f.id} value={f.id}>{f.name}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Tag *</label>
                                            <select value={newEvent.day} onChange={(e) => setNewEvent({...newEvent, day: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                                <option value="">W√§hlen</option>
                                                {weekdays.map(d => <option key={d} value={d}>{d}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Zeit *</label>
                                            <select value={newEvent.time} onChange={(e) => setNewEvent({...newEvent, time: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                                <option value="">W√§hlen</option>
                                                {timeSlots.map(t => <option key={t} value={t}>{t}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Dauer (Stunden)</label>
                                            <input type="number" step="0.5" min="0.5" max="3" value={newEvent.duration} onChange={(e) => setNewEvent({...newEvent, duration: parseFloat(e.target.value) || 1.5})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Typ *</label>
                                            <select value={newEvent.type} onChange={(e) => setNewEvent({...newEvent, type: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                                {Object.entries(eventTypes).map(([k, t]) => <option key={k} value={k}>{t.icon} {t.label}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Team {newEvent.type !== 'blocked' && '*'}</label>
                                            <select 
                                                value={newEvent.team} 
                                                onChange={(e) => setNewEvent({...newEvent, team: e.target.value})} 
                                                className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                                disabled={newEvent.type === 'blocked'}
                                            >
                                                <option value="">W√§hlen</option>
                                                {teams.map(t => <option key={t} value={t}>{t}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">
                                                {newEvent.type === 'blocked' ? 'Grund der Sperre' : 'Titel'} *
                                            </label>
                                            <input 
                                                type="text" 
                                                value={newEvent.title} 
                                                onChange={(e) => setNewEvent({...newEvent, title: e.target.value})} 
                                                className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent" 
                                                placeholder={newEvent.type === 'blocked' ? 'z.B. Platzpflege, Renovierung' : 'z.B. U15 Training'}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Trainer</label>
                                            <input 
                                                type="text" 
                                                value={newEvent.trainer} 
                                                onChange={(e) => setNewEvent({...newEvent, trainer: e.target.value})} 
                                                className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent" 
                                                placeholder="Name des Trainers"
                                                disabled={newEvent.type === 'blocked'}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Kabine</label>
                                            <select 
                                                value={newEvent.cabin} 
                                                onChange={(e) => setNewEvent({...newEvent, cabin: e.target.value})} 
                                                className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                                disabled={newEvent.type === 'blocked'}
                                            >
                                                <option value="">W√§hlen</option>
                                                {cabins.map(c => <option key={c} value={c}>{c}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Position</label>
                                            <select 
                                                value={newEvent.position} 
                                                onChange={(e) => setNewEvent({...newEvent, position: e.target.value})} 
                                                className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                                disabled={newEvent.type === 'blocked'}
                                            >
                                                {positions.map(p => <option key={p.value} value={p.value}>{p.icon} {p.label}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex gap-3 p-6 border-t bg-gray-50">
                                    <button onClick={() => setShowAddModal(false)} className="flex-1 bg-gray-300 hover:bg-gray-400 py-2 px-3 rounded-md text-sm transition-colors">Abbrechen</button>
                                    <button onClick={addEvent} className="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-3 rounded-md text-sm transition-colors">Hinzuf√ºgen</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal: Serientermine */}
                    {showSeriesModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={(e) => { if (e.target === e.currentTarget) setShowSeriesModal(false); }}>
                            <div className="bg-white rounded-lg w-full max-w-md max-h-[90vh] flex flex-col" onClick={(e) => e.stopPropagation()}>
                                <div className="flex justify-between items-center p-6 border-b">
                                    <h2 className="text-lg font-bold">Serientermine</h2>
                                    <button onClick={() => setShowSeriesModal(false)} className="text-gray-500 hover:text-gray-700 text-xl">√ó</button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-6">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Platz *</label>
                                            <select value={seriesEvent.field} onChange={(e) => setSeriesEvent({...seriesEvent, field: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                                <option value="">W√§hlen</option>
                                                {fields.map(f => <option key={f.id} value={f.id}>{f.name}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Tag *</label>
                                            <select value={seriesEvent.day} onChange={(e) => setSeriesEvent({...seriesEvent, day: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                                <option value="">W√§hlen</option>
                                                {weekdays.map(d => <option key={d} value={d}>{d}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Zeit *</label>
                                            <select value={seriesEvent.time} onChange={(e) => setSeriesEvent({...seriesEvent, time: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                                <option value="">W√§hlen</option>
                                                {timeSlots.map(t => <option key={t} value={t}>{t}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Dauer (Stunden)</label>
                                            <input type="number" step="0.5" min="0.5" max="3" value={seriesEvent.duration} onChange={(e) => setSeriesEvent({...seriesEvent, duration: parseFloat(e.target.value) || 1.5})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Typ *</label>
                                            <select value={seriesEvent.type} onChange={(e) => setSeriesEvent({...seriesEvent, type: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                                {Object.entries(eventTypes).map(([k, t]) => <option key={k} value={k}>{t.icon} {t.label}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Team *</label>
                                            <select value={seriesEvent.team} onChange={(e) => setSeriesEvent({...seriesEvent, team: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                                <option value="">W√§hlen</option>
                                                {teams.map(t => <option key={t} value={t}>{t}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Titel *</label>
                                            <input type="text" value={seriesEvent.title} onChange={(e) => setSeriesEvent({...seriesEvent, title: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="z.B. U15 Training" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Trainer</label>
                                            <input type="text" value={seriesEvent.trainer} onChange={(e) => setSeriesEvent({...seriesEvent, trainer: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Name des Trainers" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Kabine</label>
                                            <select value={seriesEvent.cabin} onChange={(e) => setSeriesEvent({...seriesEvent, cabin: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                                <option value="">W√§hlen</option>
                                                {cabins.map(c => <option key={c} value={c}>{c}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Position</label>
                                            <select value={seriesEvent.position} onChange={(e) => setSeriesEvent({...seriesEvent, position: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                                {positions.map(p => <option key={p.value} value={p.value}>{p.icon} {p.label}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Anzahl Wochen</label>
                                            <input type="number" min="1" max="52" value={seriesEvent.weeks} onChange={(e) => setSeriesEvent({...seriesEvent, weeks: parseInt(e.target.value) || 10})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent" />
                                        </div>
                                    </div>
                                </div>
                                <div className="flex gap-3 p-6 border-t bg-gray-50">
                                    <button onClick={() => setShowSeriesModal(false)} className="flex-1 bg-gray-300 hover:bg-gray-400 py-2 px-3 rounded-md text-sm transition-colors">Abbrechen</button>
                                    <button onClick={createSeriesEvents} className="flex-1 bg-purple-600 hover:bg-purple-700 text-white py-2 px-3 rounded-md text-sm transition-colors">Erstellen</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal: Termin bearbeiten */}
                    {editingEvent && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={(e) => { if (e.target === e.currentTarget) setEditingEvent(null); }}>
                            <div className="bg-white rounded-lg w-full max-w-md max-h-[90vh] flex flex-col" onClick={(e) => e.stopPropagation()}>
                                <div className="flex justify-between items-center p-6 border-b">
                                    <h2 className="text-lg font-bold">Termin bearbeiten</h2>
                                    <button onClick={() => setEditingEvent(null)} className="text-gray-500 hover:text-gray-700 text-xl">√ó</button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-6">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Platz</label>
                                            <select value={editingEvent.field} onChange={(e) => setEditingEvent({...editingEvent, field: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                                {fields.map(f => <option key={f.id} value={f.id}>{f.name}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Tag</label>
                                            <select value={editingEvent.day} onChange={(e) => setEditingEvent({...editingEvent, day: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                                {weekdays.map(d => <option key={d} value={d}>{d}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Zeit</label>
                                            <select value={editingEvent.time} onChange={(e) => setEditingEvent({...editingEvent, time: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                                {timeSlots.map(t => <option key={t} value={t}>{t}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Dauer</label>
                                            <input type="number" step="0.5" min="0.5" max="3" value={editingEvent.duration} onChange={(e) => setEditingEvent({...editingEvent, duration: parseFloat(e.target.value) || 1.5})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Typ</label>
                                            <select value={editingEvent.type} onChange={(e) => setEditingEvent({...editingEvent, type: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                                {Object.entries(eventTypes).map(([k, t]) => <option key={k} value={k}>{t.icon} {t.label}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Team</label>
                                            <select value={editingEvent.team} onChange={(e) => setEditingEvent({...editingEvent, team: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                                {teams.map(t => <option key={t} value={t}>{t}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Titel</label>
                                            <input type="text" value={editingEvent.title} onChange={(e) => setEditingEvent({...editingEvent, title: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Trainer</label>
                                            <input type="text" value={editingEvent.trainer} onChange={(e) => setEditingEvent({...editingEvent, trainer: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Kabine</label>
                                            <select value={editingEvent.cabin} onChange={(e) => setEditingEvent({...editingEvent, cabin: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                                <option value="">W√§hlen</option>
                                                {cabins.map(c => <option key={c} value={c}>{c}</option>)}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Position</label>
                                            <select value={editingEvent.position || ''} onChange={(e) => setEditingEvent({...editingEvent, position: e.target.value})} className="w-full border rounded-md p-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                                {positions.map(p => <option key={p.value} value={p.value}>{p.icon} {p.label}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex gap-3 p-6 border-t bg-gray-50">
                                    <button onClick={() => deleteEvent(editingEvent.id)} className="bg-red-600 hover:bg-red-700 text-white py-2 px-3 rounded-md text-sm transition-colors">L√∂schen</button>
                                    <button onClick={() => setEditingEvent(null)} className="flex-1 bg-gray-300 hover:bg-gray-400 py-2 px-3 rounded-md text-sm transition-colors">Abbrechen</button>
                                    <button onClick={updateEvent} className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-3 rounded-md text-sm transition-colors">Speichern</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal: Export */}
                    {showExportModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={(e) => { if (e.target === e.currentTarget) setShowExportModal(false); }}>
                            <div className="bg-white rounded-lg p-6 max-w-md w-full" onClick={(e) => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-lg font-bold">Export & Verwaltung</h2>
                                    <button onClick={() => setShowExportModal(false)} className="text-gray-500 hover:text-gray-700 text-xl">√ó</button>
                                </div>
                                <div className="space-y-3">
                                    <button 
                                        onClick={() => { exportToPDF(); setShowExportModal(false); }} 
                                        disabled={isExportingPDF}
                                        className="w-full bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white py-3 px-4 rounded-md transition-colors flex items-center justify-center gap-2"
                                    >
                                        {isExportingPDF ? '‚è≥ Erstelle PDF...' : 'üìÑ PDF exportieren'}
                                    </button>
                                    <button onClick={() => { exportToCSV(); setShowExportModal(false); }} className="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-md transition-colors flex items-center justify-center gap-2">
                                        üìä CSV exportieren
                                    </button>
                                    <button onClick={() => { exportToJSON(); setShowExportModal(false); }} className="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-md transition-colors flex items-center justify-center gap-2">
                                        üíæ Backup erstellen (JSON)
                                    </button>
                                    <div className="relative">
                                        <input 
                                            type="file" 
                                            accept=".json" 
                                            onChange={importFromJSON}
                                            className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                            id="import-file"
                                        />
                                        <label 
                                            htmlFor="import-file" 
                                            className="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-md transition-colors flex items-center justify-center gap-2 cursor-pointer"
                                        >
                                            üìÇ Backup importieren
                                        </label>
                                    </div>
                                    <button onClick={() => { window.print(); setShowExportModal(false); }} className="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-md transition-colors flex items-center justify-center gap-2">
                                        üñ®Ô∏è Drucken
                                    </button>
                                    <hr className="my-2" />
                                    <button onClick={() => { if(confirm('Alle Termine l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) { setEvents([]); window.localStorage.removeItem('football-events'); addNotification('üóëÔ∏è Alle Termine gel√∂scht', 'info'); } setShowExportModal(false); }} className="w-full bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-md transition-colors flex items-center justify-center gap-2">
                                        üóëÔ∏è Alles l√∂schen
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Notifications */}
                    <div className="fixed top-4 right-4 space-y-2 z-40">
                        {notifications.map(notification => (
                            <div key={notification.id} className={`p-3 rounded-lg shadow-lg relative transition-all duration-300 transform ${
                                notification.type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
                                notification.type === 'warning' ? 'bg-orange-100 text-orange-800 border border-orange-200' :
                                'bg-blue-100 text-blue-800 border border-blue-200'
                            } animate-slide-in`}>
                                <button onClick={() => removeNotification(notification.id)} className="absolute top-1 right-2 text-gray-500 hover:text-gray-700 text-lg leading-none">√ó</button>
                                <div className="pr-6 text-sm">{notification.message}</div>
                            </div>
                        ))}
                    </div>

                    <style jsx>{`
                        @keyframes slide-in {
                            from {
                                transform: translateX(100%);
                                opacity: 0;
                            }
                            to {
                                transform: translateX(0);
                                opacity: 1;
                            }
                        }
                        
                        .animate-slide-in {
                            animation: slide-in 0.3s ease-out;
                        }
                        
                        @media print {
                            .no-print {
                                display: none !important;
                            }
                            
                            body {
                                -webkit-print-color-adjust: exact;
                                color-adjust: exact;
                            }
                        }
                    `}</style>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
